{% extends 'base.html' %} {% block title %}Admin Panel{% endblock %}

{% block content %}
<div class="section">
  <div class="container">
    <header class="admin-header">
      <h1><i class="fas fa-user-shield"></i> Admin Dashboard</h1>
      <p>Manage customer accounts, transactions, and system activities.</p>
    </header>

    <!-- Customer Management -->
    <section class="admin-card">
      <h2 class="subsection-title">
        <i class="fas fa-users"></i> Customer Management
      </h2>
      <div class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Customer Info</th>
              <th>Account Number</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for customer in customers %}
            <tr>
              <td>{{ customer.id }}</td>
              <td>
                <strong>{{ customer.username }}</strong>

                 <!-- Status Indicator -->
            {% if customer.is_active %}
                <span class="status-badge status-active">Active</span>
            {% else %}
                <span class="status-badge status-inactive">Inactive</span>
            {% endif %}

                {% if customer.is_admin %}
                  <span class="status-badge status-admin">Admin</span>
                {% endif %}
                <br />
                <small>
                  Tier:
                  <span class="status-badge status-{{ customer.account_tier }}">
                    {{ customer.account_tier.title() }}
                  </span>
                </small>
              </td>
              <td class="monospace-font">{{ customer.account_number }}</td>
              <td class="action-cell">
                <a href="{{ url_for('admin_edit_customer', customer_id=customer.id) }}" class="btn btn-primary btn-sm">
                  <i class="fas fa-edit"></i> Manage
                </a>
                <a href="{{ url_for('admin_chat', customer_id=customer.id) }}" class="btn btn-accent btn-sm">
                  <i class="fas fa-comments"></i> Chat
                </a>

                {% if customer.id != current_user.id %}
                    {% if customer.is_active %}

                <form action="{{ url_for('admin_deactivate_customer', customer_id=customer.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to DEACTIVATE this user?');">
                        <button type="submit" class="btn btn-warning btn-sm"><i class="fas fa-user-slash"></i> Deactivate</button>
                    </form>
                {% else %}
                    <form action="{{ url_for('admin_activate_customer', customer_id=customer.id) }}" method="POST">
                        <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-user-check"></i> Activate</button>
                    </form>

                    <form action="{{ url_for('admin_delete_customer', customer_id=customer.id) }}" method="POST" onsubmit="return confirm('Are you sure? This will permanently delete the customer and all associated data.');" style="display: inline;">
                  <button type="submit" class="btn btn-danger btn-sm">
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
                {% endif %}
            {% endif %}

            
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>

        </div>
  </div>
</div>
{% endblock %}
